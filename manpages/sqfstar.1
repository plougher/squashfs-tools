.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.TH SQFSTAR "1" "April 2024" "sqfstar version 4.6.1-f3d7d01" "User Commands"
.SH NAME
sqfstar - tool to create a squashfs filesystem from a tar archive
.SH SYNOPSIS
  cat xxx.tar | sqfstar [OPTIONS] FILESYSTEM [exclude files]
  zcat xxx.tgz | sqfstar [OPTIONS] FILESYSTEM [exclude files]
  xzcat xxx.tar.xz | sqfstar [OPTIONS] FILESYSTEM [exclude files]
  zstdcat xxx.tar.zst | sqfstar [OPTIONS] FILESYSTEM [exclude files]
.SH DESCRIPTION
Squashfs is a highly compressed read-only filesystem for Linux.
It uses either gzip/xz/lzo/lz4/zstd compression to compress both files, inodes
and directories.  Inodes in the system are very small and all blocks are
packed to minimise data overhead. Block sizes greater than 4K are supported
up to a maximum of 1Mbytes (default block size 128K).

Squashfs is intended for general read-only filesystem use, for archival
use (i.e. in cases where a .tar.gz file may be used), and in constrained
block device/memory systems (e.g. embedded systems) where low overhead is
needed.
.SH OPTIONS
.SS "Filesystem compression options:"
.TP
\fB\-b\fR BLOCK_SIZE
set data block to BLOCK_SIZE.  Default 128 Kbytes. Optionally a suffix of K, KB, Kbytes or M, MB, Mbytes can be given to specify Kbytes or Mbytes respectively.
.TP
\fB\-comp\fR COMP
select COMP compression. Compressors available: gzip (default), lzo, lz4, xz, zstd.
.TP
\fB\-noI\fR
do not compress inode table.
.TP
\fB\-noId\fR
do not compress the uid/gid table (implied by \fB\-noI\fR).
.TP
\fB\-noD\fR
do not compress data blocks.
.TP
\fB\-noF\fR
do not compress fragment blocks.
.TP
\fB\-noX\fR
do not compress extended attributes.
.TP
\fB\-no\-compression\fR
do not compress any of the data or metadata.  This is equivalent to specifying \fB\-noI\fR \fB\-noD\fR \fB\-noF\fR and \fB\-noX\fR.
.SS "Filesystem build options:"
.TP
\fB\-reproducible\fR
build filesystems that are reproducible (default).
.TP
\fB\-not\-reproducible\fR
build filesystems that are not reproducible.
.TP
\fB\-mkfs\-time\fR TIME
set filesystem creation timestamp to TIME. TIME can be an unsigned 32\-bit int indicating seconds since the epoch (1970\-01\-01) or a string value which is passed to the "date" command to parse. Any string value which the date command recognises can be used such as "now", "last week", or "Wed Feb 15 21:02:39 GMT 2023".
.TP
\fB\-all\-time\fR TIME
set all file timestamps to TIME. TIME can be an unsigned 32\-bit int indicating seconds since the epoch (1970\-01\-01) or a string value which is passed to the "date" command to parse. Any string value which the date command recognises can be used such as "now", "last week", or "Wed Feb 15 21:02:39 GMT 2023".
.TP
\fB\-root\-time\fR TIME
set root directory time to TIME. TIME can be an unsigned 32\-bit int indicating seconds since the epoch (1970\-01\-01) or a string value which is passed to the "date" command to parse. Any string value which the date command recognises can be used such as "now", "last week", or "Wed Feb 15 21:02:39 GMT 2023".
.TP
\fB\-root\-mode\fR MODE
set root directory permissions to octal MODE.
.TP
\fB\-root\-uid\fR VALUE
set root directory owner to specified VALUE, VALUE can be either an integer uid or user name.
.TP
\fB\-root\-gid\fR VALUE
set root directory group to specified VALUE, VALUE can be either an integer gid or group name.
.TP
\fB\-all\-root\fR
make all files owned by root.
.TP
\fB\-force\-uid\fR VALUE
set all file uids to specified VALUE, VALUE can be either an integer uid or user name.
.TP
\fB\-force\-gid\fR VALUE
set all file gids to specified VALUE, VALUE can be either an integer gid or group name.
.TP
\fB\-default\-mode\fR MODE
tar files often do not store permissions for intermediate directories.  This option sets the default directory permissions to octal MODE, rather than 0755. This also sets the root inode mode.
.TP
\fB\-default\-uid\fR VALUE
tar files often do not store uids for intermediate directories.  This option sets the default directory owner to VALUE, rather than the user running Sqfstar. VALUE can be either an integer uid or user name.  This also sets the root inode uid.
.TP
\fB\-default\-gid\fR VALUE
tar files often do not store gids for intermediate directories.  This option sets the default directory group to VALUE, rather than the group of the user running Sqfstar.  VALUE can be either an integer uid or group name.  This also sets the root inode gid.
.TP
\fB\-pseudo\-override\fR
make pseudo file uids and gids override \fB\-all\-root\fR, \fB\-force\-uid\fR and \fB\-force\-gid\fR options.
.TP
\fB\-exports\fR
make the filesystem exportable via NFS.
.TP
\fB\-no\-sparse\fR
do not detect sparse files.
.TP
\fB\-no\-fragments\fR
do not use fragments.
.TP
\fB\-no\-tailends\fR
do not pack tail ends into fragments.
.TP
\fB\-no\-duplicates\fR
do not perform duplicate checking.
.TP
\fB\-no\-hardlinks\fR
do not hardlink files, instead store duplicates.
.SS "Filesystem filter options:"
.TP
\fB\-p\fR PSEUDO\-DEFINITION
add pseudo file definition.  The definition should be quoted.  See section "Pseudo file definition format" later for format details.
.TP
\fB\-pd\fR d mode uid gid
specify a default pseudo directory which will be used in pseudo definitions if a directory in the pathname does not exist.  This also allows pseudo definitions to be specified without specifying all the directories in the pathname.  The definition should be quoted.
.TP
\fB\-pd\fR D time mode uid gid
as above, but also allow a timestamp to be specified.
.TP
\fB\-pf\fR PSEUDO\-FILE
add list of pseudo file definitions.  Pseudo file definitions in pseudo\-files should not be quoted.
.TP
\fB\-ef\fR EXCLUDE_FILE
list of exclude dirs/files.  One per line.
.TP
\fB\-regex\fR
allow POSIX regular expressions to be used in exclude dirs/files.
.TP
\fB\-ignore\-zeros\fR
allow tar files to be concatenated together and fed to Sqfstar.  Normally a tarfile has two consecutive 512 byte blocks filled with zeros which means EOF and Sqfstar will stop reading after the first tar file on encountering them. This option makes Sqfstar ignore the zero filled blocks.
.SS "Filesystem extended attribute (xattrs) options:"
.TP
\fB\-no\-xattrs\fR
do not store extended attributes.
.TP
\fB\-xattrs\fR
store extended attributes (default).
.TP
\fB\-xattrs\-exclude\fR REGEX
exclude any xattr names matching REGEX.  REGEX is a POSIX regular expression, e.g. \fB\-xattrs\-exclude\fR '^user.' excludes xattrs from the user namespace.
.TP
\fB\-xattrs\-include\fR REGEX
include any xattr names matching REGEX.  REGEX is a POSIX regular expression, e.g. \fB\-xattrs\-include\fR '^user.' includes xattrs from the user namespace.
.TP
\fB\-xattrs\-add\fR NAME=VAL
add the xattr NAME with VAL to files.  If an user xattr it will be added to regular files and directories (see man 7 xattr).  Otherwise it will be added to all files.  VAL by default will be treated as binary (i.e. an uninterpreted byte sequence), but it can be prefixed with 0s, where it will be treated as base64 encoded, or prefixed with 0x, where val will be treated as hexidecimal.  Additionally it can be prefixed with 0t where this encoding is similar to binary encoding, except backslashes are specially treated, and a backslash followed by 3 octal digits can be used to encode any ASCII character, which obviously can be used to encode control codes.  The option can be repeated multiple times to add multiple xattrs.
.SS "Sqfstar runtime options:"
.TP
\fB\-version\fR
print version, licence and copyright message.
.TP
\fB\-force\fR
force Sqfstar to write to block device or file.
.TP
\fB\-exit\-on\-error\fR
treat normally ignored errors as fatal.
.TP
\fB\-quiet\fR
no verbose output.
.TP
\fB\-info\fR
print files written to filesystem.
.TP
\fB\-no\-progress\fR
do not display the progress bar.
.TP
\fB\-progress\fR
display progress bar when using the \fB\-info\fR option.
.TP
\fB\-percentage\fR
display a percentage rather than the full progress bar. Can be used with dialog \fB\-\-gauge\fR etc.
.TP
\fB\-throttle\fR PERCENTAGE
throttle the I/O input rate by the given percentage. This can be used to reduce the I/O and CPU consumption of Sqfstar.
.TP
\fB\-limit\fR PERCENTAGE
limit the I/O input rate to the given percentage. This can be used to reduce the I/O and CPU consumption of Sqfstar (alternative to \fB\-throttle\fR).
.TP
\fB\-processors\fR NUMBER
use NUMBER processors.  By default will use number of processors available.
.TP
\fB\-mem\fR SIZE
use SIZE physical memory for caches.  Use K, M or G to specify Kbytes, Mbytes or Gbytes respectively.
.TP
\fB\-mem\-percent\fR PERCENT
use PERCENT physical memory for caches.  Default 25%.
.TP
\fB\-mem\-default\fR
print default memory usage in Mbytes.
.SS "Expert options (these may make the filesystem unmountable):"
.TP
\fB\-nopad\fR
do not pad filesystem to a multiple of 4K.
.TP
\fB\-offset\fR OFFSET
skip OFFSET bytes at the beginning of FILESYSTEM. Optionally a suffix of K, M or G can be given to specify Kbytes, Mbytes or Gbytes respectively. Default 0 bytes.
.TP
\fB\-o\fR OFFSET
synonym for \fB\-offset\fR.
.SS "Miscellaneous options:"
.TP
\fB\-fstime\fR TIME
alternative name for mkfs\-time.
.TP
\fB\-root\-owned\fR
alternative name for \fB\-all\-root\fR.
.TP
\fB\-noInodeCompression\fR
alternative name for \fB\-noI\fR.
.TP
\fB\-noIdTableCompression\fR
alternative name for \fB\-noId\fR.
.TP
\fB\-noDataCompression\fR
alternative name for \fB\-noD\fR.
.TP
\fB\-noFragmentCompression\fR
alternative name for \fB\-noF\fR.
.TP
\fB\-noXattrCompression\fR
alternative name for \fB\-noX\fR.
.TP
\fB\-help\fR
output this options text to stdout.
.TP
\fB\-h\fR
output this options text to stdout.
.TP
\fB\-Xhelp\fR
print compressor options for selected compressor.
.SH "PSEUDO FILE DEFINITION FORMAT"
.TP
\fB\-p\fR "filename d mode uid gid"
create a directory.
.TP
\fB\-p\fR "filename m mode uid gid"
modify filename.
.TP
\fB\-p\fR "filename b mode uid gid major minor"
create a block device.
.TP
\fB\-p\fR "filename c mode uid gid major minor"
create a character device.
.TP
\fB\-p\fR "filename f mode uid gid command"
create file from stdout of command.
.TP
\fB\-p\fR "filename s mode uid gid symlink"
create a symbolic link.
.TP
\fB\-p\fR "filename i mode uid gid [s|f]"
create a socket (s) or FIFO (f).
.TP
\fB\-p\fR "filename x name=val"
create an extended attribute.
.TP
\fB\-p\fR "filename l linkname"
create a hard\-link to linkname.
.TP
\fB\-p\fR "filename L pseudo_filename"
same, but link to pseudo file.
.TP
\fB\-p\fR "filename D time mode uid gid"
create a directory with timestamp time.
.TP
\fB\-p\fR "filename M time mode uid gid"
modify a file with timestamp time.
.TP
\fB\-p\fR "filename B time mode uid gid major minor"
create block device with timestamp time.
.TP
\fB\-p\fR "filename C time mode uid gid major minor"
create char device with timestamp time.
.TP
\fB\-p\fR "filename F time mode uid gid command"
create file with timestamp time.
.TP
\fB\-p\fR "filename S time mode uid gid symlink"
create symlink with timestamp time.
.TP
\fB\-p\fR "filename I time mode uid gid [s|f]"
create socket/fifo with timestamp time.
.SH "COMPRESSORS AVAILABLE AND COMPRESSOR SPECIFIC OPTIONS"
.SS "gzip (default):"
.TP
\fB\-Xcompression\-level\fR COMPRESSION\-LEVEL
COMPRESSION\-LEVEL should be 1 .. 9 (default 9).
.TP
\fB\-Xwindow\-size\fR WINDOW\-SIZE
WINDOW\-SIZE should be 8 .. 15 (default 15).
.TP
\fB\-Xstrategy\fR strategy1,strategy2,...,strategyN
Compress using strategy1,strategy2,...,strategyN in turn and choose the best compression. Available strategies: default, filtered, huffman_only, run_length_encoded and fixed.
.SS "lzo:"
.TP
\fB\-Xalgorithm\fR ALGORITHM
Where ALGORITHM is one of: lzo1x_1, lzo1x_1_11, lzo1x_1_12, lzo1x_1_15, lzo1x_999 (default).
.TP
\fB\-Xcompression\-level\fR COMPRESSION\-LEVEL
COMPRESSION\-LEVEL should be 1 .. 9 (default 8) Only applies to lzo1x_999 algorithm.
.SS "lz4:"
.TP
\fB\-Xhc\fR
Compress using LZ4 High Compression.
.SS "xz:"
.TP
\fB\-Xbcj\fR filter1,filter2,...,filterN
Compress using filter1,filter2,...,filterN in turn (in addition to no filter), and choose the best compression. Available filters: x86, arm, armthumb, powerpc, sparc, ia64.
.TP
\fB\-Xdict\-size\fR DICT\-SIZE
Use DICT\-SIZE as the XZ dictionary size.  The dictionary size can be specified as a percentage of the block size, or as an absolute value.  The dictionary size must be less than or equal to the block size and 8192 bytes or larger.  It must also be storable in the xz header as either 2^n or as 2^n+2^(n+1). Example dict\-sizes are 75%, 50%, 37.5%, 25%, or 32K, 16K, 8K etc.
.SS "zstd:"
.TP
\fB\-Xcompression\-level\fR COMPRESSION\-LEVEL
COMPRESSION\-LEVEL should be 1 .. 22 (default 15).
.SH "EXIT STATUS"
.TP
0
Sqfstar successfully generated a filesystem.
.TP
1
Fatal errors occurred, Sqfstar aborted and did not generate a
filesystem.
.SH ENVIRONMENT
.TP
SOURCE_DATE_EPOCH
If set, this is used as the filesystem creation timestamp.  Also any file timestamps which are after SOURCE_DATE_EPOCH will be clamped to SOURCE_DATE_EPOCH.  See https://reproducible\-builds.org/docs/source\-date\-epoch/ for more information.
.SH EXAMPLES
.TP
sqfstar IMAGE.SQFS < archive.tar
Create a Squashfs filesystem from the uncompressed tar file "archive.tar".
Sqfstar will use the default compressor (normally gzip), and block size of 128
Kbytes.
.TP
zcat archive.tgz | sqfstar IMAGE.SQFS
Create a Squashfs filesystem from the compressed tar file "archive.tgz". Sqfstar
will use the default compressor (normally gzip), and block size of 128 Kbytes.
.TP
sqfstar -b 1M -comp zstd IMAGE.SQFS < archive.tar
Use a block size of 1 Mbyte and Zstandard compression to create the filesystem. 
.TP
sqfstar -root-uid 0 -root-gid 0 IMAGE.SQFS < archive.tar
Tar files do not supply a definition for the root directory, and the default is
to make the directory owned/group owned by the user running Sqfstar.  The above
command sets the ownership/group ownership to root.
.TP
sqfstar -root-mode 0755 IMAGE.SQFS < archive.tar
The default permissions for the root directory is 0777 (rwxrwxrwx).  The above
command sets the permissions to 0755 (rwxr-xr-x).
.TP
sqfstar IMAGE.SQFS file1 file2 < archive.tar
Exclude file1 and file2 from the tar file when creating filesystem.
.TP
sqfstar IMAGE.SQFS "*.gz" < archive.tar
Exclude any files in the top level directory which matches the wildcard pattern
"*.gz".
.TP
sqfstar IMAGE.SQFS "... *.gz" < archive.tar
Exclude any file which matches the wildcard pattern "*.gz" anywhere within the
tar file.  The initial "..." indicates the wildcard pattern is "non-anchored"
and will match anywhere.
.PP
Note: when passing wildcarded names to Sqfstar, they should be quoted (as in
the above examples), to ensure that they are not processed by the shell.

.SS Using pseudo file definitions
.TP
sqfstar -p "build_dir d 0644 0 0" IMAGE.SQFS < archive.tar
Create a directory called "build_dir" in the output filesystem.
.TP
sqfstar -p "version.txt l /tmp/build/version" IMAGE.SQFS < archive.tar
Create a reference called "version.txt" to a file not in the tar archive,
which acts as if that file was in the tar archive.
.TP
sqfstar -p "date.txt f 0644 0 0 date" IMAGE.SQFS < archive.tar
Create a file called "date.txt" which holds the output (stdout) from running
the "date" command.
.TP
sqfstar -p "\\"hello world\\" f 0644 0 0 date" IMAGE.SQFS < archive.tar
As above, but, showing that filenames can have spaces, if they are quoted.
The quotes need to be blackslashed to protect them from the shell.
.TP
sqfstar -p "input f 0644 root root dd if=/dev/sda1 bs=1024" IMAGE.SQFS < archive.tar
Create a file containing the contents of partition /dev/sda1".  The above allows
input from these special files to be captured and placed in the Squashfs
filesystem.
.PP
Note: pseudo file definitions should be quoted (as in the above examples), to
ensure that they are passed to Mksquashfs as a single argument, and to ensure
that they are not processed by the shell.
.SH AUTHOR
Written by Phillip Lougher <phillip@squashfs.org.uk>
.SH COPYRIGHT
Copyright \(co 2024 Phillip Lougher <phillip@squashfs.org.uk>
.PP
This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2,
or (at your option) any later version.
.PP
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.SH "SEE ALSO"
mksquashfs(1), unsquashfs(1), sqfscat(1)
.PP
The README for the Squashfs\-tools 4.6.1 release, describing the new features can be
read here https://github.com/plougher/squashfs\-tools/blob/master/README\-4.6.1
.PP
The Squashfs\-tools USAGE guide can be read here
https://github.com/plougher/squashfs\-tools/blob/master/USAGE\-4.6
